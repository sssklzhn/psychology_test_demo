# backend/fix_missing_scales.py
import json

def fix_missing_scales():
    """Добавление шкал для недостающих вопросов"""
    
    # Загружаем существующий маппинг
    with open('scales_mapping.json', 'r', encoding='utf-8') as f:
        scales_mapping = json.load(f)
    
    # Конвертируем ключи в int
    scales_mapping = {int(k): v for k, v in scales_mapping.items()}
    
    # Незамапленные вопросы
    missing_questions = [54, 59, 61, 70, 78, 90, 99, 126, 130, 134, 143, 144, 147, 157, 158, 160]
    
    print(f"Добавляем шкалы для {len(missing_questions)} вопросов")
    
    # Добавим шкалы для недостающих вопросов
    # На основе структуры теста и Excel файла
    
    additional_mapping = {
        54: ['Нейтральные'],  # Руки у меня такие же ловкие и проворные как и прежде
        59: ['Нейтральные'],  # С членами моей семьи ссорюсь редко
        61: ['Истероидность'],  # Я люблю, когда окружающие уделяют мне много внимания
        70: ['Нейтральные'],  # Моя внешность меня, в общем, устраивает
        78: ['Эмоциональные'],  # На моё настроение существенно влияет погода
        90: ['Нейтральные'],  # Меня легко привести в замешательство
        99: ['Нейтральные'],  # Приступы плохого настроения у меня бывают редко
        126: ['Нейтральные'],  # Мне кажется, что по отношению именно ко мне особенно часто поступают несправедливо
        130: ['Нейтральные'],  # Мое мнение часто не совпадает с мнением окружающих
        134: ['Нейтральные'],  # На меня обращают внимание чаще, чем на других
        143: ['Психопатическая'],  # Если в моих неудачах кто-то виноват, я не оставляю его безнаказанными
        144: ['Нейтральные'],  # В детстве я был капризный и раздражительный
        147: ['Нейтральные'],  # Мне известны случаи, когда мои родственники лечились у невропатологов и психиатров
        157: ['Нейтральные'],  # Люди меня считают спокойным и уравновешенным человеком
        158: ['Нейтральные'],  # Среди моих знакомых (родственников) есть люди употребляющие наркотики
        160: ['Нейтральные']   # Я имею представление как выглядят некоторые наркотики
    }
    
    # Добавляем в основной маппинг
    scales_mapping.update(additional_mapping)
    
    # Проверяем покрытие
    all_questions = set(range(1, 161))
    mapped_questions = set(scales_mapping.keys())
    
    print(f"\nПосле добавления:")
    print(f"Всего вопросов: 160")
    print(f"Вопросов с маппингом: {len(mapped_questions)}")
    print(f"Незамапленных: {len(all_questions - mapped_questions)}")
    
    if len(all_questions - mapped_questions) > 0:
        print(f"Остались незамапленные: {sorted(all_questions - mapped_questions)}")
    
    # Сохраняем обновленный маппинг
    with open('scales_mapping_complete.json', 'w', encoding='utf-8') as f:
        json.dump(scales_mapping, f, ensure_ascii=False, indent=2, sort_keys=True)
    
    print("\nОбновленный маппинг сохранен в scales_mapping_complete.json")
    
    # Покажем несколько примеров
    print("\nПримеры обновленного маппинга:")
    for q in [54, 59, 61, 70, 78, 99, 126, 143, 144, 157, 160]:
        print(f"Вопрос {q}: {scales_mapping.get(q, ['Нет маппинга'])}")

if __name__ == "__main__":
    fix_missing_scales()